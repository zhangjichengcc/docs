# æµè§ˆå™¨ç¼“å­˜ä¼˜åŒ–

[JavaScript æµè§ˆå™¨ç¼“å­˜æœºåˆ¶](/post/knowledge/JavaScript/JavaScriptåŸºç¡€/JavaScriptç¼“å­˜æœºåˆ¶/artical.md)

## ç¼“å­˜æœºåˆ¶

  æ ¡éªŒæ˜¯å¦è¿‡æœŸ

  Expires HTTP1.0, Cache-Control(max-age) HTTP1.1
  åè®®ä¸­Etagå¤´ä¿¡æ¯æ ¡éªŒ Etag ()
  Last-Modifiedå¤´ä¿¡æ¯æ ¡éªŒ Last-Modified (å…·ä½“æ—¶é—´)

### Catch-Control

> ç”¨äºæ§åˆ¶ç¼“å­˜çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬è®¾ç½®ç¼“å­˜çš„æœ€å¤§å­˜å‚¨æ¡ç›®æ•°ã€å­˜å‚¨æ—¶é—´ã€ç¼“å­˜ç»„åç§°ç­‰ã€‚

`Cache-Control`çš„å¯é€‰å€¼

1. `public` å…¬å¼€ä¿¡æ¯ï¼Œå¯ä»¥è¢«æµè§ˆå™¨+`CDN`è¿›è¡Œç¼“å­˜ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†é™æ€èµ„æº
2. `private` åŒ…å«`CDN`ä¸åº”è¯¥ç¼“å­˜çš„ä¿¡æ¯ï¼Œä½†æ˜¯æµè§ˆå™¨å¯ä»¥ç¼“å­˜ï¼Œä¸€èˆ¬ä¸ºå’Œç”¨æˆ·ç›¸å…³çš„æ•°æ®
3. `no-cache` åç§°å…·æœ‰ä¸€å®šçš„è¯¯å¯¼æ€§ï¼Œ`no-cache`å¹¶ä¸è¡¨ç¤ºğŸˆ²ç¼“å­˜ï¼Œè€Œæ˜¯åå•†ç¼“å­˜ï¼Œæ—¢éœ€è¦å’ŒæœåŠ¡å™¨è¿›è¡Œå†…å®¹æ ¡éªŒï¼Œå†…å®¹æ— å˜æ›´çš„æƒ…å†µä¸‹åŠ è½½æœ¬åœ°ç¼“å­˜ï¼ˆå¯¹åº”`304`çŠ¶æ€ç ï¼‰
4. `no-store` ç¦æ­¢ç¼“å­˜
5. `max-age` è¡¨ç¤ºå“åº”å¯ä»¥åœ¨ç¼“å­˜ä¸­ä¿å­˜çš„æœ€é•¿æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚
6. `s-maxage` ä¸ `max-age` ç±»ä¼¼ï¼Œä½†ä»…åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ç”Ÿæ•ˆã€‚

è®¾ç½®ç¼“å­˜çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸ`max-age`ï¼Œ`max-age`çš„å€¼é€šå¸¸ä»¥ç§’ä¸ºå•ä½çš„æ•°å­—ï¼Œå¦‚ï¼š

```nginx
add_header Cache-Control "public, max-age=120"; # è®¾ç½® 120 ç§’çš„ç¼“å­˜
```

ä½†æ˜¯å¦‚ä¸‹å€¼æœ‰ç‰¹æ®Šå«ä¹‰

1. -1 æˆ–`off`: å…³é—­ç¼“å­˜
2. `epoch`: è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º`1 January,1970,00:00:01 GMT`ï¼ˆğŸ¤”è®¾ç½®æˆè¿™ä¸ªå€¼æœ‰å•¥æ„ä¹‰å‘¢ï¼Ÿï¼‰
3. `max`: `the Unix Epoch`ï¼Œ2037 å¹´ 12 æœˆ 31 æ—¥ ï¼ˆ[2038å¹´é—®é¢˜  (opens new window)](https://baike.baidu.com/item/2038å¹´é—®é¢˜/10578442)ï¼‰
4. `30s`: `30`ç§’
5. `1m`: `1`åˆ†é’Ÿ
6. `24h`: `24`å°æ—¶
7. `3d`: `3`å¤©
8. `1M`: `1`ä¸ªæœˆ
9. `2y`: `2`å¹´

æ­¤å¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ `no-transform`æŒ‡ä»¤æ¥ç¦æ­¢å¯èƒ½å­˜åœ¨çš„ä»»ä½•è½¬æ¢ï¼Œä¾‹å¦‚ï¼Œä¸€äº›`CDN`æœåŠ¡ä¼šå‹ç¼©å›¾åƒä»¥å‡å°‘å¸¦å®½ã€‚è¯¥æŒ‡ä»¤ç¦ç”¨è¯¥è¡Œä¸ºã€‚

### proxy_catch

> ç”¨äºé…ç½®ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜ï¼ŒæŒ‡å®šç¼“å­˜çš„æŒç»­æ—¶é—´ã€ç¼“å­˜çš„é”®ç­‰

è¯¦è§å‚è€ƒæ–‡æ¡£

### catch-control å’Œ proxy_catch  çš„åŒºåˆ«

> åœ¨ `nginx` ä¸­ï¼Œ`catch-control` å’Œ `proxy_catch` æ˜¯ä¸¤ä¸ªç•¥æœ‰ä¸åŒçš„æŒ‡ä»¤ã€‚
> `catch-control` æŒ‡ä»¤ç”¨äºæ§åˆ¶ nginx æœåŠ¡å™¨è‡ªèº«çš„ç¼“å­˜è¡Œä¸ºï¼Œå¯ä»¥é’ˆå¯¹é™æ€å†…å®¹æˆ–è€…ä»£ç†çš„è¯·æ±‚è¿›è¡Œç¼“å­˜æ§åˆ¶ï¼Œé€šè¿‡è®¾ç½®ç¼“å­˜çš„æœ€å¤§å­˜å‚¨æ¡ç›®æ•°ã€å­˜å‚¨æ—¶é—´ã€ç¼“å­˜ç»„åç§°ç­‰å‚æ•°æ¥è¿›è¡Œç¼“å­˜é…ç½®ã€‚
> `proxy_catch` æŒ‡ä»¤åˆ™æ˜¯ç”¨äºé…ç½®ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜è¡Œä¸ºï¼Œå¯ä»¥æŒ‡å®šç¼“å­˜çš„æŒç»­æ—¶é—´ã€ç¼“å­˜ä½ç½®ã€ç¼“å­˜çš„é”®ç­‰å‚æ•°æ¥æ§åˆ¶ä»£ç†æœåŠ¡å™¨å¯¹åç«¯æœåŠ¡å™¨å“åº”å†…å®¹çš„ç¼“å­˜ï¼Œä»¥æé«˜è®¿é—®é€Ÿåº¦å’Œå‡è½»åç«¯æœåŠ¡å™¨å‹åŠ›ã€‚
> å› æ­¤ï¼Œä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äº `catch-control` ç”¨äºæ§åˆ¶ nginx æœåŠ¡å™¨è‡ªèº«çš„ç¼“å­˜ï¼Œè€Œ `proxy_catch` ç”¨äºé…ç½®ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜ã€‚

### ç¤ºä¾‹

```bash
server {
  listen 80;
  server_name yourdomain.com;
  root /var/www/html;
  index index.html;

  # åå•†ç¼“å­˜
  location ~* \.(js|css)$ {
    expires 1d;
    add_header Cache-Control "no-catch, public, max-age=86400";
  }

  # å¼ºç¼“å­˜
  location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
    expires 30d;
    add_header Cache-Control "public, max-age=2592000";
  }

  # ä¸ç¼“å­˜
  location / {
    expires -1;
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
  }
}
```

## å‚è€ƒæ–‡çŒ®

[nginx ç¼“å­˜é…ç½®](https://www.cnblogs.com/itzgr/p/13321980.html#)
